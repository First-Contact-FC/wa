# Configure the chat of WorkAdventure

## Some explanation
To have a better understanding of what we are going to talk, let's define an abstract variable who will be `EJABBERD_HOST=xmpp.workadventure.localhost` who is the URL where you can access the Ejabberd container from the internet.
To be sure that the Ejabberd container is working you need to configure those environnement variables :
- `EJABBERD_JWT_SECRET`: This is the secret to sign all the temporary password generated by the pusher to identify and let each user connect to the XMPP server.
- `EJABBERD_DOMAIN`: This is the domain who will identify each user of your Ejabberd network. A JID is the unique ID who will be attributed to the user like `johndoe\40workadventu.re@xmpp.example.com` where `xmpp.example.com` is the `EJABBERD_DOMAIN`. (This variable could be the same as the URL of your Ejabberd container `EJABBERD_HOST`)

The following variables will be used by the back container to create the ChatRooms who are coming from the map file. It will also be used to access the administration panel of Ejabberd at `$EJABBERD_HOST/admin`.
- `EJABBERD_USER`: This is the admin user who will be created when the Ejabberd container will be launched.
- `EJABBERD_PASSWORD`: This is the plain password of the admin user defined above.

Also, the variable `EJABBERD_WS_URI` who is defined in the `docker-compose.yaml`, can be edited. It must be defined like this : `ws://$EJABBERD_HOST/ws` where `ws://` is the protocol (WebSocket), you must set it to `wss://` if SSL is enabled, and `/ws` is the endpoint to reach to create a WebSocket between the client browser and the Ejabberd container.

## Customize the Ejabberd configuration
To customize the configuration file of Ejabberd if you want, who is here at `xmpp/ejabberd.template.yml`. You can provide more environnements variables by using `${VAR}` and you need to be sure that those variables are defined, they will be replaced when the container will be launched or build.
If some variables are not defined the container will not start and the error will be shown in the logs of the Ejabberd container.

## What to do
1. In the `.env` file :
   * Set you secret JWT sign, set the environment variable : `EJABBERD_JWT_SECRET=mySecretJwt`
   * Set your domain : `EJABBERD_DOMAIN=xmpp.workadventure.localhost`
   * Set the admin login of Ejabberd : `EJABBERD_USER=admin`
   * Set the password of the admin account of Ejabberd : `EJABBERD_PASSWORD=apideo`
2. After that you can start the Ejabberd container successfully.

## _For production environnement :_
- The variable `EJABBERD_HOST=xmpp.workadventure.localhost` must be defined.
- The variable `EJABBERD_API_URI=http://ejabberd:5443/api` is also defined, you must not change this variable, it will be used only between the container back -> Ejabberd, it will not pass through internet, just inside the local network of Docker.
You need to change it if you change the name of the container and his traefik labels.